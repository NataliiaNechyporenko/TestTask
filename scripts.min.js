"use strict";var commentUrl="http://frontend-test.pingbull.com/pages/ns.nechyporenko@gmail.com/comments",comments=document.querySelector(".comments"),count=5,commentsData=[],currentUser={id:1},buttons={replyBtn:function(e){var t=parseInt(e.target.id);document.getElementById(t+"addreplyTo").style.display="flex"},cancelReplyBtn:function(e){var t=parseInt(e.target.id),n=document.getElementById(t+"addreplyTo"),o=document.getElementById(t+"editBlock");console.log(n),n.style.display="none",o.style.display="none"},addCommentBtn:function(e){addComment(e)},deleteBtn:function(e){deleteComment(e)},editBtn:function(e){var t=parseInt(e.target.id);document.getElementById(t+"editBlock").style.display="flex";var n=document.getElementById(t+"editCommentText"),o=commentsData.filter(function(e){return e.id===t});n.value=o[0].content},sendEditComment:function(e){editComment(e)},"load-more":function(e){count+=5,getComments()}},btnHandler=function(){var e=event.target;for(var t in buttons)e.className.includes(t)&&buttons[t](event)};function isCurrentUser(e){var t=document.getElementById(e.id+"Edit"),n=document.getElementById(e.id+"Delete");e.author.id!==currentUser.id&&(t.style.display="none",n.style.display="none")}function renderComment(t){if(t.children){var e=t.children.map(function(e){return e.to=t.author.name,renderReply(e)}).join("");t.replyes=e}var n=_.template(document.getElementById("comment-template").innerHTML)(t),o=document.createElement("div");o.setAttribute("id","comment-"+t.id),o.innerHTML=n,comments.appendChild(o)}function renderReply(e){var t=_.template(document.getElementById("reply-template").innerHTML),n=document.createElement("div");return n.setAttribute("id","reply-"+e.id),n.innerHTML=t(e),n.innerHTML}var getComments=function(){comments.innerHTML="",document.querySelector("#commentText").value="",fetch(commentUrl+"?count="+count).then(function(e){if(e.ok)return e.json();throw new Error("Error fetching"+e.statusText)}).then(function(e){commentsData=e.slice(),e.map(function(e){renderComment(e),isCurrentUser(e)})}).catch(function(e){return console.log(e)})};function addComment(e){var t=parseInt(e.target.id),n={},o=document.querySelector("#commentText").value,r=document.getElementById(t+"addReply").value;(o||r)&&(n.headers={"Content-Type":"application/json"},n.method="POST",n.body=NaN!==t?JSON.stringify({content:r,parent:t}):JSON.stringify({content:o}),fetch(commentUrl,n).then(function(e){if(!e.ok)throw new Error("Error fetching data. Response status: "+e.status+" : "+e.statusText);e.json()}).then(getComments).catch(function(e){console.error("Error: ",e)}))}function deleteComment(e){var t=parseInt(e.target.id);fetch(commentUrl+"/"+t,{method:"delete"}).then(function(e){if(!e.ok)throw new Error("Error fetching data. Response status: "+e.status+" : "+e.statusText);getComments()}).catch(function(e){console.error("Error: ",e)})}function editComment(e){var t={},n=parseInt(e.target.id),o=document.getElementById(n+"editCommentText").value;o&&(t.headers={"Content-Type":"application/json"},t.method="PUT",t.body=JSON.stringify({content:o})),fetch(commentUrl+"/"+n,t).then(function(e){if(!e.ok)throw new Error("Error fetching data. Response status: "+e.status+" : "+e.statusText);getComments()}).catch(function(e){console.error("Error: ",e)})}window.onload=getComments(),document.addEventListener("click",btnHandler);